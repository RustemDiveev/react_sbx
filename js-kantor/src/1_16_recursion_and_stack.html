<!DOCTYPE HTML>
<html>

    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="./css/common.css">
    </head>

    <body>
        
        <script src="./js/1_16_script.js"></script>

        <button><a href="../start_here.html">К содержанию</a></button> 
        <h1>Рекурсия, стек</h1>
        <p>
            Рекурсия - частный случай подвызова функций внутри функции - функция вызывает саму себя.
        </p>
        <p>
            Рекурсия используется для ситуаций, когда выполнение одной сложной задачи можно представить 
            как некое действие в совокупности с решением той же задачи в более простом варианте.
        </p>

        <h2>Степень pow(x, n) через рекурсию</h2>
        <p>
            Можно представить как: pow(x, n) = x * pow(x, n-1)
        </p>
        <p>
            Алгоритм на javascript:
        </p>
<code>
function pow(x, n) {
    if (n != 1) {
        return x * pow(x, n - 1);
    } else {
        return x;
    }
}

alert(pow(2, 3));
</code>
        <p>Базис рекурсии - значение, на котором рекурсия останавливается.</p>
        <p>Глубина рекурсии - общее количество вложенных вызовов.</p>
        <p>Максимальная глубина рекурсии в браузерах, как правило, не меньше 10000.</p>

        <h2>Контекст выполнения, стек</h2>
        <p>
            У каждого вызова функции есть свой контекст выполнения (execution context).
        </p>
        <p>
            Контекст выполнения - служебная информация, соответствующая текущему запуску функции. 
            Включает в себя локальные переменные функции и конкретное место в коде, на котором находится интерпретатор.
        </p>
        <p>
            При любои вложенном вызове Javascript запоминает текущий контекст выполнения в специальной внутренней структуре данных 
            - "стеке контекстов". Потом интерпретатор приступает к вложенному вызову.
            Для нового вызова создается свой контекст выполнения и управление переходит в него, 
            а когда завершен - старый контекст достается из стека и выполнение внешней функции возобновляется.
        </p>

        <h2>Рассмотрим стек контекста на примере вызова pow(2, 3)</h2>
<code>
pow(2, 3) 
Контекст: 
    {x: 2, n: 3, строка: 1}
Натыкаемся на вложенный вызов

pow(2, 2)
Контекст: 
    {x: 2, n: 3, строка: 3}
    {x: 2, n: 2, строка: 1}
Натыкаемся на вложенный вызов

pow(2, 1)
Контекст: 
    {x: 2, n: 3, строка: 3}
    {x: 2, n: 2, строка: 3}
    {x: 2, n: 1, строка: 1}

Выходим из pow(2, 1) - его контекст вызова уничтожается, вернул 2
Контекст:
    {x: 2, n: 3, строка: 3}
    {x: 2, n: 2, строка: 3}

Выходим из pow(2, 2) - его контекст вызова уничтожается, вернул 4
Контекст:
    {x: 2, n: 3, строка: 3}

Выходим из pow(2, 3) - его контекст вызова уничтожается, вернул 8
</code>

        <h2>Выводы</h2>
        <ul>
            <li>
                Глубина рекурсии равна максимальному количеству контекстов, одновременно хранящихся в строке.
            </li>
            <li>
                Реализация через цикл более экономная, так как будет хранить один контекст.
            </li>
            <li>
                Любую рекурсию можно переделать в цикл, но это может быть нетривиальной задачей.
            </li>
        </ul>

        <h1>Задачи</h1>
        <h2>Вычислить сумму чисел до данного</h2>
        <ol>
            <li>С использованием цикла</li>
            <li>Через рекурсию</li>
            <li>Через формулу арифметической прогрессии</li>
        </ol>
        <div>
            <label for="sum_input">Число, по которое считать сумму</label>
            <input type="text" id="SUM_INPUT" name="sum_input">
            <button>Решение</button>
            <div>
                <span id="SUM_LOOP_RESULT"></span>
                <span id="SUM_LOOP_ELAPSED_TIME"></span>
            </div>
            <div>
                <span id="SUM_RECURSION_RESULT"></span>
                <span id="SUM_RECURSION_ELAPSED_TIME"></span>
            </div>
            <div>
                <span id="SUM_FORMULA_RESULT"></span>
                <span id="SUM_FORMULA_ELAPSED_TIME"></span>
            </div>
        </div>

    </body>

</html>